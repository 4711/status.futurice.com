var ticketdata;$(document).ready(function(){$("#update_data").pagerefresh({short_timeout:15*60,long_timeout:120*60,filewatch:"ittickets.json"});if(localStorage){var a=localStorage.getItem("ittickets_json");if(a!=null){try{a=JSON.parse(a);ticketdata=a;fetch_data(true)}catch(b){}}}});function fetch_data(g){var e=$("#workflowchart"),f=$("#dotschart"),c=$("#placeholder");function a(){$("body").data("ittickets-initialized",true);e.slideUp();e.empty();f.empty();$("#emailpieholder").empty();b(ticketdata.dots.all);var h=$("#total-tickets-popover");h.data("content","This is the total number of tickets since March 2010 ("+moment("2010-03-15","YYYY-MM-DD").fromNow()+"), including automatic messages");h.data("original-title","What?");h.data("placement","top");h.attr("rel","popover");h.popover("hide");h.popover({placement:popover_placement});$("#dots_all").addClass("active")}function b(h){f.empty();var m=Raphael("dotschart");var j=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23],l=[];data=h.date_stats,axisy=h.ytitles;axisx=h.xtitles;for(var n=0;n<7;n++){for(var k=0;k<24;k++){l.push(n)}}m.dotchart(10,10,900,300,j,l.reverse(),data,{symbol:"o",max:10,heat:true,axis:"0 0 1 1",axisxstep:23,axisystep:6,axisxlabels:axisx,axisxtype:" ",axisytype:" ",axisylabels:axisy.reverse()}).hover(function(){this.marker=this.marker||m.tag(this.x,this.y,this.value,0,this.r+2).insertBefore(this);this.marker.show()},function(){this.marker&&this.marker.hide()})}function d(){for(var j in ticketdata){if($("#"+j)!=null){$("#"+j).html(ticketdata[j])}}$(".dots-btn").click(function(){if($(this).hasClass("active")){return}f.show();e.slideUp();var m=$(this).data("name");b(ticketdata.dots[m]);c.html("mouse over the circles for more details");c.removeClass("hidden");$("#name2").addClass("hidden")});$("#change_graph").click(function(){c.html("mouse over the graph for more details");f.slideUp();e.html("");process(ticketdata.workflow);e.removeClass("hidden");e.slideDown()});$("#emailpieholder").empty();var l=[ticketdata.other_users,ticketdata.futurice_users],i={legend:["External %%.%%","Internal %%.%%"],legendpos:"west"};var k=Raphael("emailpieholder",400,200),h=k.piechart(190,100,69,l,i);h.hover(function(){this.sector.stop();this.sector.scale(1.1,1.1,this.cx,this.cy);if(this.label){this.label[0].stop();this.label[0].attr({r:7.5});this.label[1].attr({"font-weight":800})}},function(){this.sector.animate({transform:"s1 1 "+this.cx+" "+this.cy},500,"bounce");if(this.label){this.label[0].animate({r:5},500,"bounce");this.label[1].attr({"font-weight":400})}})}if(g){if($("body").data("ittickets-initialized")!==true){a()}d()}else{$.get("/data/ittickets.json",function(h){ticketdata=h.data;if(localStorage){localStorage.setItem("ittickets_json",JSON.stringify(ticketdata))}if($("body").data("ittickets-initialized")!==true){a()}d();$("#update_data").pagerefresh("fetch_done",(new Date()).getTime())})}};