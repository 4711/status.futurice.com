var ticketdata;$(document).ready(function(){$("#update_data").pagerefresh({short_timeout:15*60,long_timeout:120*60,filewatch:"ittickets.json"})});function fetch_data(){var e=$("#workflowchart"),f=$("#dotschart"),c=$("#placeholder");function a(){$("body").data("ittickets-initialized",true);e.slideUp();e.empty();f.empty();$("#emailpieholder").empty();b(ticketdata.dots.all);var g=$("#total-tickets-popover");g.data("content","This is the total number of tickets since March 2010 ("+moment("2010-03-15","YYYY-MM-DD").fromNow()+"), including automatic messages");g.data("original-title","What?");g.data("placement","top");g.attr("rel","popover");g.popover("hide");g.popover({placement:popover_placement});$("#dots_all").addClass("active")}function b(g){f.empty();var l=Raphael("dotschart");var h=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23],k=[];data=g.date_stats,axisy=g.ytitles;axisx=g.xtitles;for(var m=0;m<7;m++){for(var j=0;j<24;j++){k.push(m)}}l.dotchart(10,10,900,300,h,k.reverse(),data,{symbol:"o",max:10,heat:true,axis:"0 0 1 1",axisxstep:23,axisystep:6,axisxlabels:axisx,axisxtype:" ",axisytype:" ",axisylabels:axisy.reverse()}).hover(function(){this.marker=this.marker||l.tag(this.x,this.y,this.value,0,this.r+2).insertBefore(this);this.marker.show()},function(){this.marker&&this.marker.hide()})}function d(){for(var i in ticketdata){if($("#"+i)!=null){$("#"+i).html(ticketdata[i])}}$(".dots-btn").click(function(){if($(this).hasClass("active")){return}f.show();e.slideUp();var l=$(this).data("name");b(ticketdata.dots[l]);c.html("mouse over the circles for more details");c.removeClass("hidden");$("#name2").addClass("hidden")});$("#change_graph").click(function(){c.html("mouse over the graph for more details");f.slideUp();e.html("");process(ticketdata.workflow);e.removeClass("hidden");e.slideDown()});$("#emailpieholder").empty();var k=[ticketdata.other_users,ticketdata.futurice_users],h={legend:["External %%.%%","Internal %%.%%"],legendpos:"west"};var j=Raphael("emailpieholder",400,200),g=j.piechart(190,100,69,k,h);g.hover(function(){this.sector.stop();this.sector.scale(1.1,1.1,this.cx,this.cy);if(this.label){this.label[0].stop();this.label[0].attr({r:7.5});this.label[1].attr({"font-weight":800})}},function(){this.sector.animate({transform:"s1 1 "+this.cx+" "+this.cy},500,"bounce");if(this.label){this.label[0].animate({r:5},500,"bounce");this.label[1].attr({"font-weight":400})}})}if($("body").data("ittickets-initialized")!==true){a()}d()};