var ticketdata;$(document).ready(function(){$("#update_data").pagerefresh({short_timeout:15*60,long_timeout:120*60,filewatch:"ittickets.json"});if(localStorage){var a=localStorage.getItem("ittickets_json");if(a!=null){try{a=JSON.parse(a);ticketdata=a;fetch_data(true)}catch(b){}}}});function fetch_data(f){var d=$("#workflowchart"),e=$("#dotschart"),b=$("#placeholder");function a(){$("body").data("ittickets-initialized",true);d.slideUp();d.empty();e.empty();$("#emailpieholder").empty();var g=$("#total-tickets-popover");g.data("content","This is the total number of tickets since March 2010 ("+moment("2010-03-15","YYYY-MM-DD").fromNow()+"), including automatic messages");g.data("original-title","What?");g.data("placement","top");g.attr("rel","popover");g.popover("hide");g.popover({placement:popover_placement});$("#dots_all").addClass("btn-info");e.dotsgraph({data:ticketdata.dots.all});e.dotsgraph("update")}function c(){for(var h in ticketdata){if($("#"+h)!=null){$("#"+h).html(ticketdata[h])}}$(".dots-btn").click(function(){if($(this).hasClass("btn-info")){return}e.slideDown();d.slideUp();var j=$(this).data("name");e.dotsgraph({data:ticketdata.dots[j]});e.dotsgraph("update");$(".dots-btn").removeClass("btn-info");$("#change_graph").removeClass("btn-info");$(this).addClass("btn-info");b.html("mouse over the circles for more details");b.removeClass("hidden");$("#name2").addClass("hidden")});$("#change_graph").click(function(){b.html("mouse over the graph for more details");e.slideUp();d.html("");process(ticketdata.workflow);d.removeClass("hidden");d.slideDown();$(".dots-btn").removeClass("btn-info");$(this).addClass("btn-info")});var i=[ticketdata.other_users,ticketdata.futurice_users],g=["External","Internal"];Raphael("emailpieholder",400,200).pieChart(180,100,69,i,g,"#fff")}if(f){if($("body").data("ittickets-initialized")!==true){a()}c()}else{$.get("/ittickets.json",function(g){ticketdata=g.data;if(localStorage){localStorage.setItem("ittickets_json",JSON.stringify(ticketdata))}if($("body").data("ittickets-initialized")!==true){a()}c();$("#update_data").pagerefresh("fetch_done",(new Date()).getTime())})}};