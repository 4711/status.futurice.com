var ticketdata;$(document).ready(function(){$("#update_data").pagerefresh({short_timeout:15*60,long_timeout:120*60,filewatch:"ittickets.json"});if(localStorage){var a=localStorage.getItem("ittickets_json");if(a!=null){try{a=JSON.parse(a);ticketdata=a;fetch_data(true)}catch(b){}}}});function fetch_data(f){var d=$("#workflowchart"),e=$("#dotschart"),b=$("#placeholder");function a(){$("body").data("ittickets-initialized",true);d.slideUp();d.empty();e.empty();$("#emailpieholder").empty();var g=$("#total-tickets-popover");g.data("content","This is the total number of tickets since March 2010 ("+moment("2010-03-15","YYYY-MM-DD").fromNow()+"), including automatic messages");g.data("original-title","What?");g.data("placement","top");g.attr("rel","popover");g.popover("hide");g.popover({placement:popover_placement});$("#dots_all").addClass("active");e.dotsgraph({data:ticketdata.dots.all});e.dotsgraph("update")}function c(){for(var i in ticketdata){if($("#"+i)!=null){$("#"+i).html(ticketdata[i])}}$(".dots-btn").click(function(){if($(this).hasClass("active")){return}e.slideDown();d.slideUp();var l=$(this).data("name");e.dotsgraph({data:ticketdata.dots[l]});e.dotsgraph("update");b.html("mouse over the circles for more details");b.removeClass("hidden");$("#name2").addClass("hidden")});$("#change_graph").click(function(){b.html("mouse over the graph for more details");e.slideUp();d.html("");process(ticketdata.workflow);d.removeClass("hidden");d.slideDown()});$("#emailpieholder").empty();var k=[ticketdata.other_users,ticketdata.futurice_users],h={legend:["External %%.%%","Internal %%.%%"],legendpos:"west"};var j=Raphael("emailpieholder",400,200),g=j.piechart(190,100,69,k,h);g.hover(function(){this.sector.stop();this.sector.scale(1.1,1.1,this.cx,this.cy);if(this.label){this.label[0].stop();this.label[0].attr({r:7.5});this.label[1].attr({"font-weight":800})}},function(){this.sector.animate({transform:"s1 1 "+this.cx+" "+this.cy},500,"bounce");if(this.label){this.label[0].animate({r:5},500,"bounce");this.label[1].attr({"font-weight":400})}})}if(f){if($("body").data("ittickets-initialized")!==true){a()}c()}else{$.get("/ittickets.json",function(g){ticketdata=g.data;if(localStorage){localStorage.setItem("ittickets_json",JSON.stringify(ticketdata))}if($("body").data("ittickets-initialized")!==true){a()}c();$("#update_data").pagerefresh("fetch_done",(new Date()).getTime())})}};