function fetch_data(a){function c(){var m=$("body").data("printers_data");$("#printers").empty();$("#printers_accordion").empty();$("#printers_consumables").empty();$("#printers_papers").empty();var f=0;for(var i in m.printers){f++;var q=m.printers[i];var p="";if(q.alert_level.readable=="warning"){p='<span class="label label-warning">Warning</span>'}else{if(q.alert_level.readable=="unknown"){p='<span class="label label-default">Unknown</span>'}else{if(q.alert_level.readable=="running"){p='<span class="label label-success">Ok</span>'}else{if(q.alert_level.readable=="invalid"){p='<span class="label label-default">Unknown</span>'}else{if(q.alert_level.readable=="down"){p='<span class="label label-important">Down</span>'}else{if(q.alert_level.readable=="testing"){p='<span class="label label-info">Testing</span>'}}}}}}var k="<ul>";if(q.alert_text.length>0){for(var r in q.alert_text){k+="<li>"+q.alert_text[r]+"</li>"}}else{k+="<li>Everything is fine.</li>"}k+="</ul>";collapse_id="printers_collapse_"+f;var e="<span class='badge'>"+q.status.readable+"</span>";var d='<table class="table-striped">';var l='<table class="table-striped">';for(var r in q.consumables){var o=q.consumables[r],j="progress-danger";if(o.percentage>50){j="progress-success"}else{if(o.percentage>25){j="progress-warning"}}d+="<tr><td style='padding-right:15px'>"+o.name+"</td><td style='width:100px'><div style='margin-bottom: 3px' class='progress "+j+"'><div class='bar' style='width: "+o.percentage+"%'></div></div></td><td style='padding-left: 15px'><small>"+o.percentage+"%</small></tr>";if(o.percentage<60){l+="<tr><td style='padding-right:15px'>"+o.name+"</td><td style='width:100px'><div style='margin-bottom: 3px' class='progress "+j+"'><div class='bar' style='width: "+o.percentage+"%'></div></div></td><td style='padding-left: 15px'><small>"+o.percentage+"%</small></tr>"}}d+="</table>";l+="</table>";$("#printers_consumables").append('<div class="row" style="padding-top: 2em"><div class="span8"><h2>'+q.name+" "+p+" "+e+"</h2>"+d+"</div></div>");var n='<table class="table-striped">';var h='<table class="table-striped">';for(var r in q.papers){var g=q.papers[r],j="progress-danger";if(g.percentage>50){j="progress-success"}else{if(g.percentage>25){j="progress-warning"}}n+="<tr><td style='padding-right:15px'>"+g.name+"</td><td style='width:100px'><div style='margin-bottom: 3px' class='progress "+j+"'><div class='bar' style='width: "+g.percentage+"%'></div></div></td><td style='padding-left: 15px'><small>"+g.percentage+"%</small></td></tr>";if(g.percentage<50){h+="<tr><td style='padding-right:15px'>"+g.name+"</td><td style='width:100px'><div style='margin-bottom: 3px' class='progress "+j+"'><div class='bar' style='width: "+g.percentage+"%'></div></div></td><td style='padding-left: 15px'><small>"+g.percentage+"%</small></td></tr>"}}n+="</table>";h+="</table>";$("#printers_papers").append('<div class="row" style="padding-top: 2em"><div class="span8"><h2>'+q.name+" "+p+" "+e+"</h2>"+n+"</div></div>");$("#printers_accordion").append('            <div class="accordion-group">               <div class="accordion-heading"> <h2><a style="text-decoration:none" class="accordion-toggle" data-toggle="collapse" data-parent="#printers_accordion" href="#'+collapse_id+'">'+q.name+" "+p+" "+e+"</a></h2> "+k+'              </div>               <div id="'+collapse_id+'" class="accordion-body collapse">                 <div class="accordion-inner">                     <h3>Consumables</h3> '+l+"                    <h3>Paper</h3> "+h+"                </div>               </div>             </div>")}}if(a){var b=$("body").data("printers_json");$("#update_data").pagerefresh("fetch_done",b.timestamp.unix*1000);c()}else{$.getJSON("/printers.json?timestamp="+Math.floor((new Date()).getTime()/100),function(f){try{var d=$("body").data("printers_data").timestamp;if(d==f.overall.timestamp.unix){$("#update_data").pagerefresh("fetch_done",f.timestamp*1000);return}}catch(g){}if(localStorage){localStorage.setItem("printers_json",JSON.stringify(f))}$("body").data("printers_data",f);c();$("#update_data").pagerefresh("fetch_done",f.timestamp*1000)})}}$(document).ready(function(){$("#update_data").pagerefresh({short_timeout:1*60,long_timeout:15*60,filewatch:"printers.json"});if(localStorage){var a=localStorage.getItem("printers_json");if(a!=null){try{a=JSON.parse(a);$("body").data("printers_data",a);fetch_data(true)}catch(b){}}}});